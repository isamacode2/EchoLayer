<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interview Weapon</title>

<style>
body {
    font-family: -apple-system, sans-serif;
    text-align: center;
    padding: 40px;
}
button {
    padding: 20px;
    margin: 10px;
    font-size: 18px;
    border-radius: 12px;
    border: none;
}
.connect { background: #2ecc71; color: white; }
.trigger { background: #3498db; color: white; }
</style>
</head>
<body>

<h1>Interview Weapon</h1>

<button id="connectBtn" class="connect">Connect</button>
<button id="triggerBtn" class="trigger" disabled>Assist</button>

<script>

let pc;
let dc;
let localStream;
let audioElement = document.createElement("audio");
audioElement.autoplay = true;
audioElement.playsInline = true;

document.getElementById("connectBtn").onclick = async () => {
    if (!pc) {
        await connect();
    } else {
        disconnect();
    }
};

document.getElementById("triggerBtn").onclick = () => {
    if (dc && dc.readyState === "open") {
        dc.send(JSON.stringify({
            type: "response.create",
            response: {
                instructions: "Assist using strict Interview Weapon structure."
            }
        }));
    }
};

async function connect() {
    try {

        if (!audioElement.parentNode) {
            document.body.appendChild(audioElement);
        }

        pc = new RTCPeerConnection({
            iceServers: [
                { urls: "stun:stun.l.google.com:19302" }
            ]
        });

        dc = pc.createDataChannel("oai-events");

        dc.onopen = () => {

            document.getElementById("triggerBtn").disabled = false;

            dc.send(JSON.stringify({
                type: "session.update",
                session: {
                    instructions: `
You are "Interview Weapon Mode".

PRIMARY OBJECTIVE:
Discipline the userâ€™s thinking in live interviews.

STRICT GLOBAL RULES:
- Respond ONLY in English.
- NEVER fabricate experience.
- ONLY use approved story bank.
- NEVER produce paragraphs.
- No filler.
- No motivational talk.
- Be concise.
- Always end with the word STOP.

--------------------------------
OUTPUT STRUCTURE (MANDATORY)
--------------------------------
For behavioural questions:
1. One-line anchor.
2. Three compressed bullets.
3. One leadership framing line.
4. One metric/impact reminder.
5. STOP.

For technical questions:
- Root cause.
- Validation steps.
- Fix.
- Risk if ignored.
- STOP.

For executive questions:
- Decision first.
- Risk exposure.
- Business impact.
- Recommended action.
- STOP.

If user sounds anxious:
Output exactly:
Pause.
Answer in one sentence.
Then 3 bullets.
STOP.

--------------------------------
APPROVED STORY BANK
--------------------------------

ICX UPLINK / LINK AGGREGATION CONTROL PROTOCOL ISSUE
- Port 1/1/1 remained down due to membership in Link Aggregation Group 20.
- Identified that Link Aggregation Control Protocol was blocking traffic without a valid peer.
- Validated Virtual Local Area Network 20 configuration.
- Moved uplink to standalone port 1/1/48 configured untagged in VLAN 20.
- Restored connectivity without disrupting the production aggregation group.
- Prevented unnecessary physical infrastructure troubleshooting.

MACOS NETWORK STACK CORRUPTION
- Device experienced intermittent connectivity across multiple networks.
- Verified Dynamic Host Configuration Protocol lease, default gateway, routing table and tunnel interfaces.
- Compared behaviour in Safe Mode versus normal boot.
- Isolated third-party network extension corruption at operating system level.
- Prevented misattribution to network infrastructure.
- Recommended controlled remediation instead of guesswork.

SESSION INITIATION PROTOCOL APPLICATION LAYER GATEWAY ISSUE
- Wi-Fi Calling and WhatsApp calls dropping during production hours.
- Verified issue across multiple devices to rule out handset fault.
- Identified Session Initiation Protocol Application Layer Gateway interference on SonicWall firewall.
- Disabled SIP Application Layer Gateway and adjusted relevant service objects.
- Stability restored immediately.
- Root cause documented in knowledge base to prevent recurrence.

DOCUMENTATION PROCESS FAILURE
- Prioritised speed over structured documentation during a managed service incident.
- Caused duplicated troubleshooting effort.
- Implemented live documentation discipline and ownership assignment.
- Converted incidents into repeatable Standard Operating Procedures.
- Reduced recurrence and improved team efficiency.

MENTORSHIP AND ENABLEMENT
- Guided junior engineer through complex troubleshooting scenario.
- Structured issue into checklist format.
- Enabled independent resolution in future incidents.
- Leadership demonstrated through enablement, not control.

GOVERNANCE TRANSITION
- Transitioning from reactive Level 2 support into governance-driven security.
- Focus on Information Security Management System, risk reduction and repeatability.
- Emphasis on documentation discipline and scalable controls.

Always stay structured.
Always end with STOP.
`
                }
            }));

        };

        pc.ontrack = (event) => {
            audioElement.srcObject = event.streams[0];
            audioElement.play().catch(() => {});
        };

        localStream = await navigator.mediaDevices.getUserMedia({ audio: true });

        localStream.getTracks().forEach(track => {
            pc.addTrack(track, localStream);
        });

        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);

        await new Promise(resolve => {
            if (pc.iceGatheringState === "complete") {
                resolve();
            } else {
                const checkState = () => {
                    if (pc.iceGatheringState === "complete") {
                        pc.removeEventListener("icegatheringstatechange", checkState);
                        resolve();
                    }
                };
                pc.addEventListener("icegatheringstatechange", checkState);
            }
        });

        const response = await fetch("/realtime", {
            method: "POST",
            headers: {
                "Content-Type": "application/sdp"
            },
            body: pc.localDescription.sdp
        });

        if (!response.ok) {
            throw new Error("Realtime endpoint failed: " + response.status);
        }

        const answerSDP = await response.text();

        await pc.setRemoteDescription({
            type: "answer",
            sdp: answerSDP
        });

        document.getElementById("connectBtn").innerText = "Disconnect";

    } catch (err) {
        alert("Connection failed: " + err.message);
        disconnect();
    }
}

function disconnect() {
    try {
        if (pc) pc.close();
    } catch {}

    pc = null;
    document.getElementById("triggerBtn").disabled = true;
    document.getElementById("connectBtn").innerText = "Connect";
}

</script>

</body>
</html>
